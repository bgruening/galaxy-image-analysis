<tool id="ip_curve_fitting" name="Perform curve fitting" version="0.0.4" profile="20.05">
    <description></description>
    <macros>
        <import>creators.xml</import>
    </macros>
    <creator>
        <expand macro="creators/bmcv"/>
    </creator>
    <edam_operations>
        <edam_operation>operation_3443</edam_operation>
    </edam_operations>
    <xrefs>
        <xref type="bio.tools">galaxy_image_analysis</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="2.3.5">numpy</requirement>
        <requirement type="package" version="2.2.2">pandas</requirement>
        <requirement type="package" version="1.16.3">scipy</requirement>
    </requirements>
    <command>
    <![CDATA[

        mkdir ./output &&
        python '$__tool_directory__/curve_fitting.py'

            #for $input in $input_list
                #if $input
                    --input '$input'
                #end if
            #end for

            ./output
            $degree
            $penalty
            $alpha

    ]]>
    </command>
    <inputs>
        <param name="input_list" type="data" format="tsv,tabular" multiple="true" label="Lists of intensity values"/>
        <param name="degree" type="select" label="Degree of the polynomial function">
            <option value="2" selected="True">2nd degree</option>
            <option value="1">1st degree</option>
        </param>
        <param name="penalty" type="select" label="Optimization objective for fitting">
            <option value="abs" selected="True">Least absolute deviations (LAD)</option>
            <option value="quadratic">Least squares (LS)</option>
            <option value="student-t">Robust non-convex penalty</option>
        </param>
        <param name="alpha" type="float" value="0.01" label="Significance level for generating assistive curves" />
    </inputs>
    <outputs>
        <collection type="list" name="output" label="Curve fitting on ${on_string}">
            <discover_datasets directory="output" pattern="__name__" format="tsv"/>
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="input_list" value="input1.tsv"/>
            <param name="degree" value="2"/>
            <param name="penalty" value="abs"/>
            <param name="alpha" value="0.01"/>
            <output_collection name="output" type="list" count="1">
                <element name="curve1.tsv" value="output1/curve1.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
        </test>
        <test>
            <param name="input_list" value="input1.tsv,input2.tsv"/>
            <param name="degree" value="2"/>
            <param name="penalty" value="abs"/>
            <param name="alpha" value="0.01"/>
            <output_collection name="output" type="list" count="2">
                <element name="curve1.tsv" value="output2/curve1.tsv" ftype="tsv" compare="diff"/>
                <element name="curve2.tsv" value="output2/curve2.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
        </test>
    </tests>
    <help>

        **Perform curve fitting for lists of intensity values.**

        This tool fits 1st- or 2nd-order polynomial curves to 1-D data points (tabular list of values).

        Optionally, given a significance level, assistive curves are generated.

    </help>
    <citations>
        <citation type="doi">10.1097/j.pain.0000000000002642</citation>
    </citations>
</tool>
